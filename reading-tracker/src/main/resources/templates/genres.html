<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <title>Browse by Genre</title>
    <link rel="stylesheet" href="/css/genres.css">
	<script src="/js/authenticate.js"></script> 
</head>
<body>
	
	<div class="container">
	        <h1>Books by Genre</h1>
	        <div class="genre-options">
	            <select id="genre-select">
	            <option value="">-- Select Genre --</option>
	        </select>
	        </div>        
	        <div id="genre-books"></div>
	</div>    

	    <div class="wrapper">
			<nav>
				<ul class="nav-links">
					<li><a href="/api/home">‚¨ÖÔ∏è Back</a></li>
				</ul>
			</nav>
		</div>
	    <br>

    <script>
        const token = localStorage.getItem("token");

        async function loadGenres() {
            const res = await fetch("/api/home/genres/list", {
                headers: { "Authorization": `Bearer ${token}` }
            });
            const genres = await res.json();
            const select = document.getElementById("genre-select");
            genres.forEach(g => {
                const opt = document.createElement("option");
                opt.value = g;
                opt.innerText = g;
                select.appendChild(opt);
            });
        }

        async function loadBooksByGenre(genre) {
            const res = await fetch(`/api/home/genres/books?genre=${encodeURIComponent(genre)}`, {
                headers: { "Authorization": `Bearer ${token}` }
            });
            const books = await res.json();
            const container = document.getElementById("genre-books");
            container.innerHTML = books.map(book => `
                <div class="book-card">
                    <img src="${book.image}" alt="${book.name}">
                    <div class="book-info">
                        <h3>${book.name}</h3>
                        <p><strong>Author:</strong> ${book.author}</p>
                        <p><strong>Status:</strong><span style="text-transform: capitalize;"> ${book.status}</span></p>
						<div class="book-actions">
                        <a href="/api/home/view?id=${book.id}">üëÅÔ∏è View</a>
						</div>
                    </div>
                </div>
            `).join("");
        }

        document.getElementById("genre-select").addEventListener("change", (e) => {
            if (e.target.value) loadBooksByGenre(e.target.value);
        });

        loadGenres();
    </script>
</body>
</html>
