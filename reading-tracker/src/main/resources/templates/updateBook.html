<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Update Book Page</title>
    <link rel="stylesheet" href="/css/formStyle.css">
	<script src="/js/authenticate.js"></script> 
</head>
<body>
	<div class="container">
			<h1>Update Book</h1>
			<form id="updateBookForm" class="form-data">
		        <input type="hidden" name="id">
				<p>Book Name</p>
		        <input name="name" placeholder="Book Name" required><br>
				<p>Description</p>
		        <textarea name="description" placeholder="Description"></textarea><br>
				<p>End Date</p>
		        <input type="date" name="endDate"><br>
				<p>Rating</p>
		        <div class="rating-container">
					<div class="rating-stars">
						<input type="radio" id="star5" name="rating" value="5">
						<label for="star5">★</label>
						<input type="radio" id="star4" name="rating" value="4">
						<label for="star4">★</label>
						<input type="radio" id="star3" name="rating" value="3">
						<label for="star3">★</label>
						<input type="radio" id="star2" name="rating" value="2">
						<label for="star2">★</label>
						<input type="radio" id="star1" name="rating" value="1">
						<label for="star1">★</label>
					</div>
				</div>
				<p>Genre</p>
		        <input name="genre" placeholder="Genre"><br>
				<p>Status</p>
		        <select name="status">
		            <option value="to-read">To Read</option>
		            <option value="current">Current</option>
		            <option value="read">Read</option>
		        </select><br>
		        <button type="submit">Update</button>
		    </form>
		</div>

		<div class="wrapper">
			<nav>
				<ul class="nav-links">
					<li><a href="/api/home">⬅️ Back</a></li>
				</ul>
			</nav>
		</div>
		<br>
		
		
	    <script>
	        const params = new URLSearchParams(window.location.search);
	        const bookId = params.get("id");

	        async function loadBook() {
	            const token = localStorage.getItem("token");
	            const res = await fetch(`/api/home/update?id=${bookId}`, {
	                headers: { "Authorization": `Bearer ${token}` }
	            });
	            const book = await res.json();
	            for (const key in book) {
	                if (document.querySelector(`[name=${key}]`)) {
	                    document.querySelector(`[name=${key}]`).value = book[key];
	                }
	            }
	        }

	        document.getElementById("updateBookForm").addEventListener("submit", async function(e) {
	            e.preventDefault();
	            const form = e.target;
				const formData = new FormData(form);
	            const book = {};
				
				for (const [key, value] of formData.entries()) {
				        if (value !== "") {
				            book[key] = value;
				        }
				    }
				
	            const token = localStorage.getItem("token");

	            await fetch(`/api/home/update?id=${bookId}`, {
	                method: "PUT",
	                headers: {
	                    "Content-Type": "application/json",
	                    "Authorization": `Bearer ${token}`
	                },
	                body: JSON.stringify(book)
	            });
	            window.location.href = "/api/home";
	        });

	        loadBook();
	    </script>
</body>
</html>